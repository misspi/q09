<script type="text/javascript">
  jQuery(function($) {
    $("td input").hover(function() {
      $(this).parent().find(".tooltip").show();
    }, function() {
      $(this).parent().find(".tooltip").hide();
    });

    $(".flash").click(function() {$(this).fadeSliderToggle('fast');});
    $.prevent(function () {
      return $(".changed").length > 0;
    });
  });

  $(function(){
    $("form").dirty_form();
  });

  (function ($) {
    $.prevent = function(isDirty) {
      window.onbeforeunload = function() {
        if (isDirty()) {
          return "Cuidado!! No has guardado! Si pulsas 'Continuar' se perder√°n los cambios. Mejor pulsa 'Cancelar' y luego 'Guardar'";
        } else {
          return null;
        }
      };
      $("form").submit(function() {
        if (!isDirty()) {
          window.onbeforeunload = null;
        }
        var submit = $(this).find("input[type=submit]");
        submit.val("Un momento por favor...");
        submit.attr("disabled", "true");
        window.onbeforeunload = null;
        return true;
      });

    }
  })(jQuery);

  jQuery.fn.fadeSliderToggle = function(settings) {
    /* Damn you jQuery opacity:'toggle' that dosen't work!~!!!*/
    settings = jQuery.extend({
      speed:500,
      easing : "swing"
    }, settings)

    caller = this
    if($(caller).css("display") == "none"){
      $(caller).animate({
        opacity: 1,
        height: 'toggle'
      }, settings.speed, settings.easing);
    }else{
      $(caller).animate({
        opacity: 0,
        height: 'toggle'
      }, settings.speed, settings.easing);
    }
  };
</script>